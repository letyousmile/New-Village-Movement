# LOAD BALANCE(로드밸런스, 부하 분산)
로드 밸런스는 서버에 가해지는 부하를 분산해주는 것을 말하고 이러한 일을 하는 장시나 기술을 로드밸런서라고 한다. 로드밸런서는 클라이언트와 서버풀(Server Pool, 분산 네트워크를 구성하는 서버들의 그룹) 사이에 위치하며, 한 대의 서버로 부하가 집중되지 않도록 한다.

서버의 이용자 수가 많아지면서 이를 커버할 수 있는 방법은 Scale-up(서버 자체의 성능을 늘려주는 방법)과, Scale-out(여러대의 서버로 트래픽을 분산시켜주는 방법)이 있고 Scale-out방식으로 트래픽 증가에 대처를 하기로 했다면 로드밸런싱은 필수선택이다.

### 로드밸런싱 알고리즘
- 라운드로빈(Round Robin)
    서버에 들어온 요청을 순서대로 돌아가면서 배정. 여러대의 서버가 동일한 스펙일 경우 좋음

- 가중 라운드로빈(Weighted Round Robin)
    각 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분함. 서버의 능력이 다를 경우 주로 사용.

- IP 해시(IP Hash)
    클라이언트 IP 주소를 특정 서버로 매핑하여 처리하는 방식. 사용자가 항상 동일한 서버로 연결되는 것을 보장한다.

- 최소 연결(Least Connection)
    요청이 들어온 시점에 가장 적은 연결상태를 가지는 서버로 연결. 서버에 분배된 트래픽들이 일정하지 않은 경우 적합함(세션 유지시간이 차이가 심한 경우)

- 최소 리스폰타임(Least Response Time)
    서버의 현재 연결 상태와 응답시간을 모두 고려하여 트래픽을 배분. 가장 적은 연결상태 + 가장 짧은 응답시간 => 우선배분.

### L4 vs L7

로드밸런싱에는 L4와 L7 로드밸런서가 가장 많이 사용된다. 그 이유는 L4계층 부터 Port정보를 바탕으로 로드밸런싱이 가능하기 떄문이다. 

L4 로드밸런서는 네투워크 계층(IP, IPX)나 트랜스포트 계층(TCP, UDP)의 정보를 바탕으로 로드밸런싱을 한다. IP주소, 포트번호, MAC주소, 전송 프로토콜 등에 따라 트래픽을 나누는 것이 가능하다.

L7 로드밸런서의 경우에는 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다.(NGINX 로드밸런싱 처럼 URL에 따라 로드밸런싱도 가능함) L7로드밸런싱의 장점은 요청의 패턴을 감지해 바이러스를 감지할 수 있고 DDOS같은 비정상적 트래픽을 필터링 할 수 있기 때문에 보안 측면에서 활용이 많이된다.

아무래도 L7 로드밸런싱은 L4에 비해 패킷의 복호화를 해야하기 때문에 속도면에선 느리다. L4는 속도면에서 빠르고 가격이 저렴하지만 사용자의 IP가 수시로 바뀌는 경우 연속적인 서비스를 제공하기가 어렵다는 단점이 있다.

